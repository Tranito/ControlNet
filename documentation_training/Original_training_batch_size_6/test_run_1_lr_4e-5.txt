(control) long@mps-pc-02:~/ControlNet-for-BEP$ python3 Cityscapes_train.py
logging improved.
No module 'xformers'. Proceeding without it.
ControlLDM: Running in eps-prediction mode
DiffusionWrapper has 859.52 M params.
making attention of type 'vanilla' with 512 in_channels
Working with z of shape (1, 4, 32, 32) = 4096 dimensions.
making attention of type 'vanilla' with 512 in_channels
Loaded model config from [./models/cldm_v15.yaml]
Loaded state_dict from [/home/long/ControlNet-for-BEP/log/test_run_lr_4e-5/epoch=2-step=1487.ckpt]
GPU available: True, used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
/home/long/anaconda3/envs/control/lib/python3.8/site-packages/pytorch_lightning/trainer/configuration_validator.py:280: LightningDeprecationWarning: Base `LightningModule.on_train_batch_start` hook signature has changed in v1.5. The `dataloader_idx` argument will be removed in v1.7.
  rank_zero_deprecation(
/home/long/anaconda3/envs/control/lib/python3.8/site-packages/pytorch_lightning/trainer/configuration_validator.py:287: LightningDeprecationWarning: Base `Callback.on_train_batch_end` hook signature has changed in v1.5. The `dataloader_idx` argument will be removed in v1.7.
  rank_zero_deprecation(
initializing distributed: GLOBAL_RANK: 0, MEMBER: 1/1
----------------------------------------------------------------------------------------------------
distributed_backend=nccl
All distributed processes registered. Starting with 1 processes
----------------------------------------------------------------------------------------------------

LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]

  | Name              | Type               | Params
---------------------------------------------------------
0 | model             | DiffusionWrapper   | 859 M 
1 | first_stage_model | AutoencoderKL      | 83.7 M
2 | cond_stage_model  | FrozenCLIPEmbedder | 123 M 
3 | control_model     | ControlNet         | 361 M 
---------------------------------------------------------
1.2 B     Trainable params
206 M     Non-trainable params
1.4 B     Total params
5,710.058 Total estimated model params size (MB)
Validation sanity check: 0it [00:00, ?it/s]/home/long/anaconda3/envs/control/lib/python3.8/site-packages/pytorch_lightning/trainer/data_loading.py:110: UserWarning: The dataloader, val_dataloader 0, does not have many workers which may be a bottleneck. Consider increasing the value of the `num_workers` argument` (try 32 which is the number of cpus on this machine) in the `DataLoader` init to improve performance.
  rank_zero_warn(
Validation sanity check:   0%|                            | 0/2 [00:00<?, ?it/s]/home/long/anaconda3/envs/control/lib/python3.8/site-packages/pytorch_lightning/utilities/data.py:56: UserWarning: Trying to infer the `batch_size` from an ambiguous collection. The batch size we found is 6. To avoid any miscalculations, use `self.log(..., batch_size=batch_size)`.
  warning_cache.warn(
/home/long/anaconda3/envs/control/lib/python3.8/site-packages/pytorch_lightning/trainer/data_loading.py:110: UserWarning: The dataloader, train_dataloader, does not have many workers which may be a bottleneck. Consider increasing the value of the `num_workers` argument` (try 32 which is the number of cpus on this machine) in the `DataLoader` init to improve performance.
  rank_zero_warn(
Epoch 0:   0%|                                          | 0/580 [00:00<?, ?it/s]Data shape for DDIM sampling is (4, 4, 32, 64), eta 0.0
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:22<00:00,  2.23it/s]
Epoch 0:  69%|▋| 400/580 [10:10<04:34,  1.53s/it, loss=0.138, v_num=13, train/loData shape for DDIM sampling is (4, 4, 32, 64), eta 0.0
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:23<00:00,  2.16it/s]
Epoch 0:  85%|▊| 495/580 [12:54<02:12,  1.56s/it, loss=0.153, v_num=13, train/lo/home/long/anaconda3/envs/control/lib/python3.8/site-packages/pytorch_lightning/utilities/data.py:56: UserWarning: Trying to infer the `batch_size` from an ambiguous collection. The batch size we found is 5. To avoid any miscalculations, use `self.log(..., batch_size=batch_size)`.
  warning_cache.warn(
Epoch 0: 100%|█| 580/580 [14:37<00:00,  1.51s/it, loss=0.156, v_num=13, train/lo/home/long/anaconda3/envs/control/lib/python3.8/site-packages/pytorch_lightning/utilities/data.py:56: UserWarning: Trying to infer the `batch_size` from an ambiguous collection. The batch size we found is 2. To avoid any miscalculations, use `self.log(..., batch_size=batch_size)`.
  warning_cache.warn(
Epoch 1:   0%| | 0/580 [00:00<?, ?it/s, loss=0.156, v_num=13, train/loss_simple_Data shape for DDIM sampling is (4, 4, 32, 64), eta 0.0                         
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:22<00:00,  2.18it/s]
Epoch 1:  69%|▋| 400/580 [10:10<04:34,  1.53s/it, loss=0.152, v_num=13, train/loData shape for DDIM sampling is (4, 4, 32, 64), eta 0.0
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:23<00:00,  2.16it/s]
Epoch 2:   0%| | 0/580 [00:00<?, ?it/s, loss=0.158, v_num=13, train/loss_simple_Data shape for DDIM sampling is (4, 4, 32, 64), eta 0.0                         
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:23<00:00,  2.16it/s]
Epoch 2:  69%|▋| 400/580 [10:11<04:35,  1.53s/it, loss=0.16, v_num=13, train/losData shape for DDIM sampling is (4, 4, 32, 64), eta 0.0
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:23<00:00,  2.16it/s]
Epoch 3:   0%| | 0/580 [00:00<?, ?it/s, loss=0.15, v_num=13, train/loss_simple_sData shape for DDIM sampling is (4, 4, 32, 64), eta 0.0                         
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:23<00:00,  2.16it/s]
Epoch 3:  69%|▋| 400/580 [10:16<04:37,  1.54s/it, loss=0.148, v_num=13, train/loData shape for DDIM sampling is (4, 4, 32, 64), eta 0.0
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:23<00:00,  2.16it/s]
Epoch 4:   0%| | 0/580 [00:00<?, ?it/s, loss=0.137, v_num=13, train/loss_simple_Data shape for DDIM sampling is (4, 4, 32, 64), eta 0.0                         
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:23<00:00,  2.14it/s]
Epoch 4:  69%|▋| 400/580 [10:18<04:38,  1.55s/it, loss=0.15, v_num=13, train/losData shape for DDIM sampling is (4, 4, 32, 64), eta 0.0
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:23<00:00,  2.16it/s]
Epoch 5:   0%| | 0/580 [00:00<?, ?it/s, loss=0.124, v_num=13, train/loss_simple_Data shape for DDIM sampling is (4, 4, 32, 64), eta 0.0                         
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:23<00:00,  2.16it/s]
Epoch 5:  69%|▋| 400/580 [10:12<04:35,  1.53s/it, loss=0.145, v_num=13, train/loData shape for DDIM sampling is (4, 4, 32, 64), eta 0.0
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:23<00:00,  2.12it/s]
Epoch 6:   0%| | 0/580 [00:00<?, ?it/s, loss=0.148, v_num=13, train/loss_simple_Data shape for DDIM sampling is (4, 4, 32, 64), eta 0.0                         
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:23<00:00,  2.12it/s]
Epoch 6:  69%|▋| 400/580 [10:19<04:38,  1.55s/it, loss=0.147, v_num=13, train/loData shape for DDIM sampling is (4, 4, 32, 64), eta 0.0
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:23<00:00,  2.09it/s]
Epoch 7:   0%| | 0/580 [00:00<?, ?it/s, loss=0.142, v_num=13, train/loss_simple_Data shape for DDIM sampling is (4, 4, 32, 64), eta 0.0                         
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:23<00:00,  2.17it/s]
Epoch 7:  69%|▋| 400/580 [10:18<04:38,  1.55s/it, loss=0.153, v_num=13, train/loData shape for DDIM sampling is (4, 4, 32, 64), eta 0.0
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:23<00:00,  2.17it/s]
Epoch 8:   0%| | 0/580 [00:00<?, ?it/s, loss=0.142, v_num=13, train/loss_simple_Data shape for DDIM sampling is (4, 4, 32, 64), eta 0.0                         
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:22<00:00,  2.19it/s]
Epoch 8:  69%|▋| 400/580 [10:08<04:33,  1.52s/it, loss=0.127, v_num=13, train/loData shape for DDIM sampling is (4, 4, 32, 64), eta 0.0
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:23<00:00,  2.17it/s]
Epoch 9:   0%| | 0/580 [00:00<?, ?it/s, loss=0.168, v_num=13, train/loss_simple_Data shape for DDIM sampling is (4, 4, 32, 64), eta 0.0                         
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:23<00:00,  2.17it/s]
Epoch 9:  69%|▋| 400/580 [10:07<04:33,  1.52s/it, loss=0.153, v_num=13, train/loData shape for DDIM sampling is (4, 4, 32, 64), eta 0.0
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:23<00:00,  2.17it/s]
Epoch 10:   0%| | 0/580 [00:00<?, ?it/s, loss=0.158, v_num=13, train/loss_simpleData shape for DDIM sampling is (4, 4, 32, 64), eta 0.0                         
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:23<00:00,  2.17it/s]
Epoch 10:  69%|▋| 400/580 [10:08<04:33,  1.52s/it, loss=0.151, v_num=13, train/lData shape for DDIM sampling is (4, 4, 32, 64), eta 0.0
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:23<00:00,  2.17it/s]
Epoch 11:   0%| | 0/580 [00:00<?, ?it/s, loss=0.129, v_num=13, train/loss_simpleData shape for DDIM sampling is (4, 4, 32, 64), eta 0.0                         
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:22<00:00,  2.17it/s]
Epoch 11:  69%|▋| 400/580 [10:07<04:33,  1.52s/it, loss=0.134, v_num=13, train/lData shape for DDIM sampling is (4, 4, 32, 64), eta 0.0
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:22<00:00,  2.17it/s]
Epoch 12:   0%| | 0/580 [00:00<?, ?it/s, loss=0.152, v_num=13, train/loss_simpleData shape for DDIM sampling is (4, 4, 32, 64), eta 0.0                         
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:22<00:00,  2.17it/s]
Epoch 12:  69%|▋| 400/580 [10:13<04:35,  1.53s/it, loss=0.131, v_num=13, train/lData shape for DDIM sampling is (4, 4, 32, 64), eta 0.0
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:23<00:00,  2.11it/s]
Epoch 13:   0%| | 0/580 [00:00<?, ?it/s, loss=0.132, v_num=13, train/loss_simpleData shape for DDIM sampling is (4, 4, 32, 64), eta 0.0                         
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:23<00:00,  2.16it/s]
Epoch 13:  69%|▋| 400/580 [10:14<04:36,  1.54s/it, loss=0.153, v_num=13, train/lData shape for DDIM sampling is (4, 4, 32, 64), eta 0.0
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:23<00:00,  2.17it/s]
Epoch 14:   0%| | 0/580 [00:00<?, ?it/s, loss=0.15, v_num=13, train/loss_simple_Data shape for DDIM sampling is (4, 4, 32, 64), eta 0.0                         
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:22<00:00,  2.17it/s]
Epoch 14:  69%|▋| 400/580 [10:10<04:34,  1.53s/it, loss=0.156, v_num=13, train/lData shape for DDIM sampling is (4, 4, 32, 64), eta 0.0
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:23<00:00,  2.16it/s]
Epoch 15:   0%| | 0/580 [00:00<?, ?it/s, loss=0.129, v_num=13, train/loss_simpleData shape for DDIM sampling is (4, 4, 32, 64), eta 0.0                         
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:23<00:00,  2.17it/s]
Epoch 15:  69%|▋| 400/580 [10:13<04:36,  1.53s/it, loss=0.123, v_num=13, train/lData shape for DDIM sampling is (4, 4, 32, 64), eta 0.0
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:23<00:00,  2.17it/s]
Epoch 16:   0%| | 0/580 [00:00<?, ?it/s, loss=0.131, v_num=13, train/loss_simpleData shape for DDIM sampling is (4, 4, 32, 64), eta 0.0                         
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:23<00:00,  2.16it/s]
Epoch 16:  69%|▋| 400/580 [10:18<04:38,  1.55s/it, loss=0.152, v_num=13, train/lData shape for DDIM sampling is (4, 4, 32, 64), eta 0.0
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:23<00:00,  2.17it/s]
Epoch 17:   0%| | 0/580 [00:00<?, ?it/s, loss=0.134, v_num=13, train/loss_simpleData shape for DDIM sampling is (4, 4, 32, 64), eta 0.0                         
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:23<00:00,  2.17it/s]
Epoch 17:  69%|▋| 400/580 [10:12<04:35,  1.53s/it, loss=0.111, v_num=13, train/lData shape for DDIM sampling is (4, 4, 32, 64), eta 0.0
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:23<00:00,  2.16it/s]
Epoch 18:   0%| | 0/580 [00:00<?, ?it/s, loss=0.144, v_num=13, train/loss_simpleData shape for DDIM sampling is (4, 4, 32, 64), eta 0.0                         
Running DDIM Sampling with 50 timesteps
DDIM Sampler: 100%|█████████████████████████████| 50/50 [00:23<00:00,  2.17it/s]
Epoch 18:  63%|▋| 363/580 [09:15<05:31,  1.53s/it, loss=0.132, v_num=13, train/l^C/home/long/anaconda3/envs/control/lib/python3.8/site-packages/pytorch_lightning/trainer/trainer.py:685: UserWarning: Detected KeyboardInterrupt, attempting graceful shutdown...
  rank_zero_warn("Detected KeyboardInterrupt, attempting graceful shutdown...")